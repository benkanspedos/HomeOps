# Traefik Dynamic Configuration for ATOM V7 Reactor War Room
# Routes reactor.dealsniperpro.io to financial-tracker backend
# Serves ML prediction API and bubble chart data

http:
  middlewares:
    # CORS headers for Reactor API (war-room frontend)
    reactor-cors:
      headers:
        accessControlAllowMethods:
          - GET
          - POST
          - OPTIONS
          - PUT
          - DELETE
        accessControlAllowHeaders:
          - Content-Type
          - Authorization
          - X-Requested-With
        accessControlAllowOriginList:
          - "https://war-room.dealsniperpro.io"
          - "https://reactor.dealsniperpro.io"
          - "*"
        accessControlMaxAge: 86400
        addVaryHeader: true

    # Chain for Reactor API routes (CORS only)
    # Note: HTTP caching handled by Cloudflare + browser
    reactor-api:
      chain:
        middlewares:
          - reactor-cors

  routers:
    # Reactor API router - all /api/v7/reactor/* endpoints
    reactor-api-router:
      rule: "Host(`reactor.dealsniperpro.io`) && PathPrefix(`/api/v7/reactor`)"
      service: reactor-backend
      entryPoints:
        - web
        - websecure
      middlewares:
        - reactor-api
      priority: 100

    # Fallback for other paths (health checks, etc)
    reactor-router:
      rule: "Host(`reactor.dealsniperpro.io`)"
      service: reactor-service
      entryPoints:
        - web
        - websecure
      priority: 1

  services:
    # Frontend React app (Vite) - runs in container on homeops-network
    # NO PORTS - accessed only through Traefik
    # Docker Compose labels: traefik.enable=true
    reactor-service:
      loadBalancer:
        servers:
          - url: "http://reactor-dashboard:80"
        healthCheck:
          path: "/"
          interval: "30s"
          timeout: "5s"

    # Backend API service for /api/v7/reactor routes
    # Runs on financial-tracker container, port 8891 (internal only)
    reactor-backend:
      loadBalancer:
        servers:
          - url: "http://financial-tracker:8891"
        healthCheck:
          path: "/api/status"
          interval: "30s"
          timeout: "5s"
