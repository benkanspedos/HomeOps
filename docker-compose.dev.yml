version: '3.8'

# Development overrides
services:
  gluetun:
    # In development, you might want to disable VPN for faster local testing
    environment:
      - VPN_SERVICE_PROVIDER=${DEV_VPN_PROVIDER:-none}
      - DOT=off  # Disable DNS over TLS for local development
    ports:
      # Additional development ports
      - "9229:9229"  # Node.js debugging
      - "5555:5555"  # Prisma Studio
      - "4000:4000"  # GraphQL playground

  backend:
    build:
      context: ./backend
      dockerfile: ../Dockerfile.backend
      target: development
    volumes:
      - ./backend:/app
      - ./backend/.env.local:/app/.env.local
    environment:
      - NODE_ENV=development
      - DEBUG=homeops:*
      - NODE_OPTIONS=--inspect=0.0.0.0:9229
    command: npm run dev

  # Local PostgreSQL for development (optional, if not using Supabase)
  postgres-dev:
    image: postgres:15-alpine
    container_name: homeops-postgres-dev
    ports:
      - "5433:5432"
    volumes:
      - postgres-dev-data:/var/lib/postgresql/data
      - ./supabase/migrations:/docker-entrypoint-initdb.d
    environment:
      - POSTGRES_USER=homeops
      - POSTGRES_PASSWORD=localdev123
      - POSTGRES_DB=homeops_dev
    networks:
      - homeops-network

  # Adminer for database management
  adminer:
    image: adminer:latest
    container_name: homeops-adminer
    ports:
      - "8081:8080"
    environment:
      - ADMINER_DEFAULT_SERVER=postgres-dev
    networks:
      - homeops-network

  # Mailhog for email testing
  mailhog:
    image: mailhog/mailhog:latest
    container_name: homeops-mailhog
    ports:
      - "1025:1025"  # SMTP
      - "8025:8025"  # Web UI
    networks:
      - homeops-network

volumes:
  postgres-dev-data: